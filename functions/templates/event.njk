{% extends "components/layout.njk" %}

{% block title %}{{ event.name }} | イツスル | 日程調整ツール{% endblock %}

{% block content %}
  <div>
    <h2>{{ event.name }}</h2>
    <nav>
      <ul>
        <li>
          <a href="/?eventId={{ event.id }}">編集</a>
        </li>
      </ul>
    </nav>
  </div>
  <section>
    <div>
      <label>みんなにURLを共有しよう</label>
    </div>
    <div>
      <input type="text" readonly
        _="on load put location.href into me.value
           on click call navigator.clipboard.writeText(me.value)"/>
    </div>
  </section>
  <section>
    <table>
      <tr>
        <th></th>
        {% for c in event.candidateDates %}
          <th>{{ c.date }}<br/>{{ c.time }}</th>
        {% endfor %}
      </tr>
      {% if participants.length > 0 %}
        {% for p in participants %}
          <tr>
            <th>
              <a href="/edit?eventId={{event.id}}&participantId={{ p.id }}">
                {{ p.name }}
              </a>
            </th>

            {% for c in event.candidateDates %}
              <td>
                {{p.responses[c.date ~ "T" ~ c.time]}}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="{{ event.candidateDates.length + 1 }}">
            早速予定を入力しよう
          </td>
        </tr>
      {% endif %}
    </table>
  </section>
  <section>
    <button
      hx-get="/edit?eventId={{event.id}}"
      hx-push-url="true"
      hx-swap="outerHTML"
      hx-select=".wrapper"
      hx-target="closest .wrapper"
    >
      予定を入力
    </button>
  </section>
{% endblock %}